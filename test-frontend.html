<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API Test - ICS Connect</title>
    <style>
        body { font-family: system-ui; max-width: 900px; margin: 50px auto; padding: 20px; }
        button { padding: 10px 20px; margin: 10px 5px; cursor: pointer; background: #007bff; color: white; border: none; border-radius: 4px; }
        button:hover { background: #0056b3; }
        .success { color: green; }
        .error { color: red; }
        pre { background: #f5f5f5; padding: 10px; border-radius: 5px; overflow-x: auto; font-size: 12px; }
        .test-section { border: 1px solid #ddd; padding: 15px; margin: 15px 0; border-radius: 8px; }
        .api-call { background: #1e1e1e; color: #d4d4d4; padding: 12px; border-radius: 5px; margin: 10px 0; font-family: 'Courier New', monospace; font-size: 13px; }
        .api-call .method { color: #4ec9b0; font-weight: bold; }
        .api-call .url { color: #ce9178; }
        .api-call .header { color: #9cdcfe; }
        .api-call .json { color: #b5cea8; }
        h2 { color: #333; margin-top: 0; }
        input { padding: 8px; border: 1px solid #ddd; border-radius: 4px; }
    </style>
</head>
<body>
    <h1>ðŸ§ª ICS Connect API Test Suite</h1>
    <p>Testing API endpoints from browser context - see the exact API calls below each test</p>

    <div class="test-section">
        <h2>1. Health Check</h2>
        <button onclick="testHealth()">Test Health Endpoint</button>
        <div class="api-call">
<span class="method">GET</span> <span class="url">https://event-planner-production-d03d.up.railway.app/api/v1/health</span>

No headers or body required
        </div>
        <pre id="health-result"></pre>
    </div>

    <div class="test-section">
        <h2>2. Search Events</h2>
        <button onclick="testSearch()">Test Search</button>
        <div class="api-call">
<span class="method">GET</span> <span class="url">https://event-planner-production-d03d.up.railway.app/api/v1/search?limit=3</span>

Query params:
  <span class="json">limit=3</span> - Returns max 3 events in array
  <span class="json">q=keyword</span> - Filter by keyword
  <span class="json">start=ISO_DATE&to=ISO_DATE</span> - Filter by date range
  <span class="json">offset=0</span> - For pagination (skip N results)

Response includes: <span class="json">events[]</span> (max 3) and <span class="json">total</span> (all matching in DB)
        </div>
        <pre id="search-result"></pre>
    </div>

    <div class="test-section">
        <h2>3. Get Event Details</h2>
        <input type="text" id="event-id" placeholder="Event ID" style="width: 400px;">
        <button onclick="testGetEvent()">Get Event</button>
        <div class="api-call">
<span class="method">GET</span> <span class="url">https://event-planner-production-d03d.up.railway.app/api/v1/events/{event_id}</span>

Replace <span class="json">{event_id}</span> with actual UUID
        </div>
        <pre id="get-event-result"></pre>
    </div>

    <div class="test-section">
        <h2>4. Create Event</h2>
        <button onclick="testCreateEvent()">Create Test Event</button>
        <div class="api-call">
<span class="method">POST</span> <span class="url">https://event-planner-production-d03d.up.railway.app/api/v1/events</span>
<span class="header">Content-Type:</span> application/json

<span class="json">{
  "title": "Frontend Test Event",
  "description": "Created from browser test",
  "starts_at": "2025-11-06T12:00:00.000Z",
  "ends_at": "2025-11-06T14:00:00.000Z",
  "location_text": "Test Location",
  "capacity": 25,
  "public": true,
  "requires_join_code": false,
  "tags": ["test"]
}</span>
        </div>
        <pre id="create-result"></pre>
    </div>

    <div class="test-section">
        <h2>5. Auth/Login</h2>
        <button onclick="testAuth()">Test Login</button>
        <div class="api-call">
<span class="method">POST</span> <span class="url">https://event-planner-production-d03d.up.railway.app/api/v1/auth/login</span>
<span class="header">Content-Type:</span> application/json

<span class="json">{
  "email": "testuser@uci.edu",
  "display_name": "Test User"
}</span>
        </div>
        <pre id="auth-result"></pre>
    </div>

    <div class="test-section">
        <h2>6. RSVP to Event</h2>
        <input type="text" id="rsvp-event-id" placeholder="Event ID" style="width: 400px;">
        <button onclick="testRSVP()">RSVP</button>
        <div class="api-call">
<span class="method">POST</span> <span class="url">https://event-planner-production-d03d.up.railway.app/api/v1/events/{event_id}/reserve</span>
<span class="header">Content-Type:</span> application/json

<span class="json">{
  "display_name": "Test User",
  "email": "test@uci.edu",
  "join_code": null
}</span>
        </div>
        <pre id="rsvp-result"></pre>
    </div>

    <script>
        const API_BASE = 'https://event-planner-production-d03d.up.railway.app/api/v1';

        async function testHealth() {
            const result = document.getElementById('health-result');
            try {
                const response = await fetch(`${API_BASE}/health`);
                const data = await response.json();
                result.className = 'success';
                result.textContent = 'âœ… Success!\n' + JSON.stringify(data, null, 2);
            } catch (error) {
                result.className = 'error';
                result.textContent = 'âŒ Error: ' + error.message;
            }
        }

        async function testSearch() {
            const result = document.getElementById('search-result');
            try {
                const response = await fetch(`${API_BASE}/search?limit=3`);
                const data = await response.json();
                result.className = 'success';
                result.textContent = 'âœ… Success! Found ' + data.total + ' events\n' +
                                    JSON.stringify(data, null, 2);
            } catch (error) {
                result.className = 'error';
                result.textContent = 'âŒ Error: ' + error.message;
            }
        }

        async function testGetEvent() {
            const result = document.getElementById('get-event-result');
            const eventId = document.getElementById('event-id').value;
            if (!eventId) {
                result.className = 'error';
                result.textContent = 'âŒ Please enter an event ID';
                return;
            }
            try {
                const response = await fetch(`${API_BASE}/events/${eventId}`);
                const data = await response.json();
                result.className = response.ok ? 'success' : 'error';
                result.textContent = (response.ok ? 'âœ… Success!\n' : 'âŒ Error:\n') +
                                    JSON.stringify(data, null, 2);
            } catch (error) {
                result.className = 'error';
                result.textContent = 'âŒ Error: ' + error.message;
            }
        }

        async function testCreateEvent() {
            const result = document.getElementById('create-result');
            try {
                const now = new Date();
                const starts = new Date(now.getTime() + 24 * 60 * 60 * 1000); // tomorrow
                const ends = new Date(starts.getTime() + 2 * 60 * 60 * 1000); // +2 hours

                const response = await fetch(`${API_BASE}/events`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        title: 'Frontend Test Event',
                        description: 'Created from browser test',
                        starts_at: starts.toISOString(),
                        ends_at: ends.toISOString(),
                        location_text: 'Test Location',
                        capacity: 25,
                        public: true,
                        requires_join_code: false,
                        tags: ['test']
                    })
                });
                const data = await response.json();
                result.className = response.ok ? 'success' : 'error';
                result.textContent = (response.ok ? 'âœ… Success! Event created:\n' : 'âŒ Error:\n') +
                                    JSON.stringify(data, null, 2);

                // Auto-fill event ID fields
                if (response.ok && data.event) {
                    document.getElementById('event-id').value = data.event.id;
                    document.getElementById('rsvp-event-id').value = data.event.id;
                }
            } catch (error) {
                result.className = 'error';
                result.textContent = 'âŒ Error: ' + error.message;
            }
        }

        async function testAuth() {
            const result = document.getElementById('auth-result');
            try {
                const response = await fetch(`${API_BASE}/auth/login`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        email: 'testuser@uci.edu',
                        display_name: 'Test User'
                    })
                });
                const data = await response.json();
                result.className = response.ok ? 'success' : 'error';
                result.textContent = (response.ok ? 'âœ… Success! Token received\n' : 'âŒ Error:\n') +
                                    JSON.stringify(data, null, 2);

                // Store token for later use
                if (response.ok && data.token) {
                    localStorage.setItem('auth_token', data.token);
                }
            } catch (error) {
                result.className = 'error';
                result.textContent = 'âŒ Error: ' + error.message;
            }
        }

        async function testRSVP() {
            const result = document.getElementById('rsvp-result');
            const eventId = document.getElementById('rsvp-event-id').value;
            if (!eventId) {
                result.className = 'error';
                result.textContent = 'âŒ Please enter an event ID';
                return;
            }
            try {
                const response = await fetch(`${API_BASE}/events/${eventId}/reserve`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        display_name: 'Test User',
                        email: 'test@uci.edu'
                    })
                });
                const data = await response.json();
                result.className = response.ok ? 'success' : 'error';
                result.textContent = (response.ok ? 'âœ… Success! RSVP created:\n' : 'âŒ Error:\n') +
                                    JSON.stringify(data, null, 2);
            } catch (error) {
                result.className = 'error';
                result.textContent = 'âŒ Error: ' + error.message;
            }
        }

        // Auto-run health check and search on load
        window.addEventListener('load', () => {
            testHealth();
            testSearch();
        });
    </script>
</body>
</html>
